\ProvidesPackage{xmpp}

\RequirePackage{listings}
\RequirePackage{hyperref}

\makeatletter
\newcommand*{\xml}{\@ifstar{\@xmlStar}{\@xmlNoStar}}
\newcommand*{\@xmlNoStar}[1]{\texttt{\textless #1\textgreater}}
\newcommand*{\@xmlStar}[1]{\texttt{\textless/#1\textgreater}}
\makeatother

\newcommand*{\attr}[2]{%
	#1=\textquotesingle #2\textquotesingle%
}
\newcommand*{\procinst}{\xml{?xml \attr{version}{1.0}?}}
\newcommand*{\xep}[2][]{\href{https://xmpp.org/extensions/xep-#2.html}{XEP-#2\ifthenelse{\isempty{#1}}{\relax}{: #1}}}
\newcommand*{\stanza}[1]{\xml{#1/}}
\newcommand*{\nonza}[1]{\xml{#1/}}
\newcommand*{\hcstatus}[1]{\textit{Status}: #1\ by HipChat}
\newcommand*{\rfc}[2][]{\href{https://tools.ietf.org/html/rfc#2}{RFC #2\ifthenelse{\isempty{#1}}{\relax}{: #1}}}

\makeatletter
\newcommand*{\xmppim}{\@ifstar{\@xmppimStar}{\@xmppimNoStar}}
\newcommand*{\@xmppimNoStar}{\rfc[XMPP IM]{6121}}
\newcommand*{\@xmppimStar}{XMPP-IM}
\newcommand*{\xmppcore}{\@ifstar{\@xmppcoreStar}{\@xmppcoreNoStar}}
\newcommand*{\@xmppcoreNoStar}{\rfc[XMPP Core]{6120}}
\newcommand*{\@xmppcoreStar}{XMPP-CORE}
\newcommand*{\xmppaddr}{\@ifstar{\@xmppaddrStar}{\@xmppaddrNoStar}}
\newcommand*{\@xmppaddrNoStar}{\rfc[XMPP Address Format]{7622}}
\newcommand*{\@xmppaddrStar}{XMPP-ADDR}
\newcommand*{\xmpptls}{\@ifstar{\@xmpptlsStar}{\@xmpptlsNoStar}}
\newcommand*{\@xmpptlsNoStar}{\rfc[Use of TLS in XMPP]{7590}}
\newcommand*{\@xmpptlsStar}{XMPP-TLS}
\makeatother

\definecolor{maroon}{rgb}{0.5,0,0}
\definecolor{darkgreen}{rgb}{0,0.5,0}
\lstdefinelanguage{XML}{
  basicstyle=\ttfamily,
  morestring=[s]{"}{"},
  morestring=[s]{'}{'},
  morecomment=[s]{?}{?},
  morecomment=[s]{!--}{--},
  commentstyle=\color{darkgreen},
  moredelim=[s][\color{black}]{>}{<},
  moredelim=[s][\color{red}]{\ }{=},
  stringstyle=\color{blue},
  identifierstyle=\color{maroon}
}
